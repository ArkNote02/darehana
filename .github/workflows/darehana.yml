name: darehana

on:
  # 手動実行
  workflow_dispatch:
  # 定期実行（月-木 16:00+0900）
  schedule:
    - cron: '0 7 * * 1-4'

env:
  TZ: 'Asia/Tokyo'

jobs:
  execute:
    # イメージ
    runs-on: ubuntu-latest

    steps:
      # チェックアウト
      - name: checkout
        uses: actions/checkout@v2

      # ダウンロード
      - name: dowonload
        run: |
          Y=`date '+%Y'`
          M=`date '+%m'`
          D=`date '+%d'`
          mkdir -p ./${Y}/${M}/
          cd ./${Y}/${M}/
          rm -f ${Y}${M}${D}.xml
          curl "https://radiko.jp/v2/api/noa?station_id=FMT&ft=${Y}${M}${D}130000&to=${Y}${M}${D}145500" -o ${Y}${M}${D}.xml

      # プッシュ
      - name: push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "${GITHUB_ACTOR}"
          git config --global user.email "${GITHUB_ACTOR}@users.noreply.github.com"
          git add .
          git commit -m "Scheduled action"
          git push origin master
